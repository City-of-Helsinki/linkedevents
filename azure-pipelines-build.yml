# Build pipeline
# Builds images for dev, test, staging and production

trigger:
  batch: true
  branches:
    include:
      - develop
      - refs/tags/staging-*
      - refs/tags/release-*
  paths:
    exclude:
      - README.md

# PR's are tested by github actions
pr: none
pool: Default

resources:
  repositories:
    - repository: linkedevents-pipelines
      type: git
      name: linkedevents/linkedevents-pipelines

extends:
  template: azure-pipelines-build-linkedevents-api.yml@linkedevents-pipelines
  parameters:
    ${{ if startsWith(variables['Build.SourceBranch'], 'refs/tags/release-') }}:
      buildenv: -prod
    ${{ elseif startsWith(variables['Build.SourceBranch'], 'refs/tags/staging-') }}:
      buildenv: -staging
    ${{ else }}:
      buildenv: -dev
